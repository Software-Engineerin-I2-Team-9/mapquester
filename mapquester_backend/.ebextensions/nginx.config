files:
  "/etc/nginx/nginx.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      user nginx;
      worker_processes auto;
      error_log /var/log/nginx/error.log;
      pid /var/run/nginx.pid;

      events {
          worker_connections 1024;
      }

      http {
          include /etc/nginx/mime.types;
          default_type application/octet-stream;

          server {
              listen 80;
              server_name localhost;

              location / {
                  proxy_pass http://unix:/tmp/gunicorn.sock;
                  proxy_set_header Host $host;
                  proxy_set_header X-Real-IP $remote_addr;
                  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                  proxy_set_header X-Forwarded-Proto $scheme;
              }

              location /health {
                  return 200 'OK';
                  add_header Content-Type text/plain;
              }
          }
      }

container_commands:
  01_restart_nginx:
    command: "sudo service nginx restart"
    ignoreErrors: true